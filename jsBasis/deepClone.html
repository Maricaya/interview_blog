<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>深拷贝 | blog</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="系统性学习，打造完善的知识体系">
    
    <link rel="preload" href="/interview_blog/assets/css/0.styles.81bffcaa.css" as="style"><link rel="preload" href="/interview_blog/assets/js/app.6e789ca6.js" as="script"><link rel="preload" href="/interview_blog/assets/js/2.aedcd1eb.js" as="script"><link rel="preload" href="/interview_blog/assets/js/25.dbe614ed.js" as="script"><link rel="prefetch" href="/interview_blog/assets/js/10.235d3cd2.js"><link rel="prefetch" href="/interview_blog/assets/js/11.64c88d1d.js"><link rel="prefetch" href="/interview_blog/assets/js/12.389e02a9.js"><link rel="prefetch" href="/interview_blog/assets/js/13.5fd0b99f.js"><link rel="prefetch" href="/interview_blog/assets/js/14.addbf244.js"><link rel="prefetch" href="/interview_blog/assets/js/15.aaa172ef.js"><link rel="prefetch" href="/interview_blog/assets/js/16.efde6c27.js"><link rel="prefetch" href="/interview_blog/assets/js/17.efe499ad.js"><link rel="prefetch" href="/interview_blog/assets/js/18.b43e2679.js"><link rel="prefetch" href="/interview_blog/assets/js/19.1e7d1f1d.js"><link rel="prefetch" href="/interview_blog/assets/js/20.61100763.js"><link rel="prefetch" href="/interview_blog/assets/js/21.77d90c63.js"><link rel="prefetch" href="/interview_blog/assets/js/22.f398ec5f.js"><link rel="prefetch" href="/interview_blog/assets/js/23.a0ed082a.js"><link rel="prefetch" href="/interview_blog/assets/js/24.a5e14725.js"><link rel="prefetch" href="/interview_blog/assets/js/26.f2947465.js"><link rel="prefetch" href="/interview_blog/assets/js/27.ccd771c7.js"><link rel="prefetch" href="/interview_blog/assets/js/28.78bc3610.js"><link rel="prefetch" href="/interview_blog/assets/js/29.ad03d3fc.js"><link rel="prefetch" href="/interview_blog/assets/js/3.b709dd0d.js"><link rel="prefetch" href="/interview_blog/assets/js/30.12e12cb8.js"><link rel="prefetch" href="/interview_blog/assets/js/31.63b1cf5c.js"><link rel="prefetch" href="/interview_blog/assets/js/32.10ace32c.js"><link rel="prefetch" href="/interview_blog/assets/js/33.14d149d9.js"><link rel="prefetch" href="/interview_blog/assets/js/34.b8c73cce.js"><link rel="prefetch" href="/interview_blog/assets/js/35.3e8d4f21.js"><link rel="prefetch" href="/interview_blog/assets/js/36.ed8a1bb7.js"><link rel="prefetch" href="/interview_blog/assets/js/37.ce354d46.js"><link rel="prefetch" href="/interview_blog/assets/js/38.37bcf5ce.js"><link rel="prefetch" href="/interview_blog/assets/js/39.d4956b62.js"><link rel="prefetch" href="/interview_blog/assets/js/4.87406268.js"><link rel="prefetch" href="/interview_blog/assets/js/40.f0ecd4dc.js"><link rel="prefetch" href="/interview_blog/assets/js/41.01c18d9c.js"><link rel="prefetch" href="/interview_blog/assets/js/42.f229993f.js"><link rel="prefetch" href="/interview_blog/assets/js/43.f08935e7.js"><link rel="prefetch" href="/interview_blog/assets/js/44.d134aed1.js"><link rel="prefetch" href="/interview_blog/assets/js/45.dbda6222.js"><link rel="prefetch" href="/interview_blog/assets/js/46.661000b0.js"><link rel="prefetch" href="/interview_blog/assets/js/47.12709f91.js"><link rel="prefetch" href="/interview_blog/assets/js/48.d8e794b9.js"><link rel="prefetch" href="/interview_blog/assets/js/5.c38690e3.js"><link rel="prefetch" href="/interview_blog/assets/js/6.f9104e5b.js"><link rel="prefetch" href="/interview_blog/assets/js/7.397ab168.js"><link rel="prefetch" href="/interview_blog/assets/js/8.3afdacb3.js"><link rel="prefetch" href="/interview_blog/assets/js/9.a12c6f31.js">
    <link rel="stylesheet" href="/interview_blog/assets/css/0.styles.81bffcaa.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/interview_blog/" class="home-link router-link-active"><!----> <span class="site-name">blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/interview_blog/" class="nav-link">
  文章目录
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/interview_blog/" class="nav-link">
  文章目录
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/interview_blog/" aria-current="page" class="sidebar-link">JavaScript</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>vue3 UI</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>JS 基础</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/interview_blog/jsBasis/chain.html" class="sidebar-link">原型链</a></li><li><a href="/interview_blog/jsBasis/extend.html" class="sidebar-link">继承</a></li><li><a href="/interview_blog/jsBasis/deepClone.html" aria-current="page" class="active sidebar-link">深拷贝</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/interview_blog/jsBasis/deepClone.html#什么是深拷贝" class="sidebar-link">什么是深拷贝</a></li><li class="sidebar-sub-header"><a href="/interview_blog/jsBasis/deepClone.html#询问" class="sidebar-link">询问</a></li><li class="sidebar-sub-header"><a href="/interview_blog/jsBasis/deepClone.html#开始写" class="sidebar-link">开始写</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/interview_blog/jsBasis/deepClone.html#最简单的方法" class="sidebar-link">最简单的方法</a></li><li class="sidebar-sub-header"><a href="/interview_blog/jsBasis/deepClone.html#如何实现支持以上类型的深拷贝" class="sidebar-link">如何实现支持以上类型的深拷贝？</a></li><li class="sidebar-sub-header"><a href="/interview_blog/jsBasis/deepClone.html#为什么使用class" class="sidebar-link">为什么使用class？</a></li></ul></li><li class="sidebar-sub-header"><a href="/interview_blog/jsBasis/deepClone.html#完整代码" class="sidebar-link">完整代码</a></li><li class="sidebar-sub-header"><a href="/interview_blog/jsBasis/deepClone.html#面试中写这些就行" class="sidebar-link">面试中写这些就行</a></li></ul></li><li><a href="/interview_blog/jsBasis/throttle.html" class="sidebar-link">防抖 vs 节流</a></li><li><a href="/interview_blog/jsBasis/promise.html" class="sidebar-link">手写 promise</a></li><li><a href="/interview_blog/jsBasis/cros.html" class="sidebar-link">跨域问题</a></li><li><a href="/interview_blog/jsBasis/module.html" class="sidebar-link">模块化发展历程</a></li><li><a href="/interview_blog/jsBasis/flatten.html" class="sidebar-link">数组拍平 &amp; 去重</a></li><li><a href="/interview_blog/jsBasis/promiseSchedule.html" class="sidebar-link">promise schedule</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>TypeScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ajax &amp; jsonp</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>webpack</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>http</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>浏览器原理</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>安全</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>设计模式</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>函数式编程</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>算法</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>SSR</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>CSS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>react</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="深拷贝"><a href="#深拷贝" class="header-anchor">#</a> 深拷贝</h1> <h3 id="深拷贝-2"><a href="#深拷贝-2" class="header-anchor">#</a> 深拷贝</h3> <p>完成一个高性能的深拷贝。
参考 <a href="https://github.com/lodash/lodash/blob/master/.internal/baseClone.js" target="_blank" rel="noopener noreferrer">loadsh<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>深拷贝是面试常考的知识点，也经常容易出错，下面来看看我的答题思路吧。</p> <h2 id="什么是深拷贝"><a href="#什么是深拷贝" class="header-anchor">#</a> 什么是深拷贝</h2> <p>理解一：</p> <ul><li>假设b是a的一份拷贝，并且b中没有对a对象的引用。</li></ul> <p>理解二：</p> <ul><li>b是a的一份拷贝。</li> <li>把a和b画出图，a与b之间没有连接。</li></ul> <h2 id="询问"><a href="#询问" class="header-anchor">#</a> 询问</h2> <p>在做任何与算法、需求相关时，都要问这几个问题：</p> <ul><li>询问数据类型
<ul><li>拷贝的数据中有什么？</li></ul></li> <li>询问数据规模
<ul><li>10？</li> <li>10w？</li> <li>10w个嵌套？</li></ul></li> <li>性能要求
<ul><li>对时间、空间、速度要求</li></ul></li> <li>运行环境
<ul><li>IE6？Chrome?</li></ul></li> <li>其他要求
<ul><li>有没有其他内容？</li></ul></li> <li>开始写</li></ul> <h2 id="开始写"><a href="#开始写" class="header-anchor">#</a> 开始写</h2> <h3 id="最简单的方法"><a href="#最简单的方法" class="header-anchor">#</a> 最简单的方法</h3> <p>JSON序列化反序列化</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  a<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  b<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  c<span class="token operator">:</span> <span class="token punctuation">{</span>d1<span class="token operator">:</span> <span class="token string">'ddd'</span><span class="token punctuation">,</span> d2<span class="token operator">:</span> <span class="token string">'ccc'</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> obj1 <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span>
obj1<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">2</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>a<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>这个方法的缺点是什么？</p> <ul><li>不支持<code>function</code> <ul><li>以前有函数报错，现在是直接忽略</li></ul></li> <li>不支持<code>undefined</code> (支持<code>null</code>)</li> <li>不支持引用.JSON不支持环状结构，只支出树状结构
<ul><li><code>a.self = a</code> <code>a(#100).self = (#101)</code></li></ul></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'a'</span>
<span class="token punctuation">}</span>
a<span class="token punctuation">.</span>self <span class="token operator">=</span> a
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>不支持<code>Date</code>,会把 <code>new Date()</code> 变成字符串</li> <li>不支持正则表达式</li> <li>不支持<code>symbol</code></li></ul> <h3 id="如何实现支持以上类型的深拷贝"><a href="#如何实现支持以上类型的深拷贝" class="header-anchor">#</a> 如何实现支持以上类型的深拷贝？</h3> <p>递归</p> <ul><li>看节点类型（7种）</li> <li>基本类型，直接拷贝</li> <li>object分情况讨论
<ul><li>普通object - for in</li> <li>数组Array - Array初始化</li> <li>函数 -  怎么拷贝？闭包？</li> <li>日期Date - 怎么拷贝？</li></ul></li></ul> <h4 id="完成浅拷贝-基本类型"><a href="#完成浅拷贝-基本类型" class="header-anchor">#</a> 完成浅拷贝 - 基本类型</h4> <p>6 种基本数据类型 <code>number string boolean undefined null symbol</code></p> <p>不是引用类型，直接返回即可</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">DeepClone</span> <span class="token punctuation">{</span>
    <span class="token function">clone</span> <span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> source
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="完成对象拷贝"><a href="#完成对象拷贝" class="header-anchor">#</a> 完成对象拷贝</h4> <p>判断数据是不是对象<code>xxx instanceof Object</code></p> <h5 id="能够复制普通对象"><a href="#能够复制普通对象" class="header-anchor">#</a> 能够复制普通对象</h5> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'cat'</span><span class="token punctuation">,</span> child<span class="token operator">:</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'miaomiao'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">DeepClone</span> <span class="token punctuation">{</span>
  <span class="token function">clone</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>source <span class="token keyword">instanceof</span> <span class="token class-name">Object</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> dist <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token comment">// 使用for in 遍历对象上所有数据</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> source<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        dist<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span>source<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span> 
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> dist
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> source
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> DeepClone
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h5 id="能够复制数组"><a href="#能够复制数组" class="header-anchor">#</a> 能够复制数组</h5> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">clone</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>source <span class="token keyword">instanceof</span> <span class="token class-name">Object</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> dist <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">/****************************/</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>source <span class="token keyword">instanceof</span> <span class="token class-name">Array</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      dist <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/****************************/</span>
    <span class="token comment">// 使用for in 遍历对象上所有数据</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> source<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      dist<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span>source<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span> 
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> dist
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> source
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h5 id="能够复制函数"><a href="#能够复制函数" class="header-anchor">#</a> 能够复制函数</h5> <p>既然是函数，那么拷贝时再调用一次即可。</p> <p>调用原函数算深拷贝吗？
这里要回到我们对深拷贝的定义：没有互相引用。</p> <p>这里调用了一下原函数，算不算互相引用呢？
只有执行时才引用，没有执行的时候没有引用，而且函数调用的堆栈不一样。很难明确算不算互相引用。</p> <p>再回到深拷贝的定义，深拷贝不是一种术语，而是程序员们都认同的方法，这样写也没问题。</p> <p>函数由环境和参数决定。环境无法更改，在定义时已经决定。参数是this、传递的参数。使用<code>...arguments</code> 传递。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Clone</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>source <span class="token keyword">instanceof</span> <span class="token class-name">Object</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> dist <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>source <span class="token keyword">instanceof</span> <span class="token class-name">Array</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      dist <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/****************************/</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>source <span class="token keyword">instanceof</span> <span class="token class-name">Function</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function-variable function">dist</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">source</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token operator">...</span>arguments<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/****************************/</span>
    <span class="token comment">// 使用for in 遍历对象上所有数据</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> source<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      dist<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span>source<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span> 
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> dist
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> source
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h5 id="这种方式的缺点"><a href="#这种方式的缺点" class="header-anchor">#</a> 这种方式的缺点</h5> <h6 id="使用了递归-环引用"><a href="#使用了递归-环引用" class="header-anchor">#</a> 使用了递归: 环引用</h6> <p>递归：必须有一个结尾，目前的对象都有一个末尾。如果对象是一个环呢？</p> <p>window 就是一个环引用 window.self = window</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">'cat'</span><span class="token punctuation">}</span>
  a<span class="token punctuation">.</span>self <span class="token operator">=</span> a
<span class="token comment">// 不能写成</span>
<span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'a'</span><span class="token punctuation">,</span> self<span class="token operator">:</span> a <span class="token punctuation">}</span>
<span class="token comment">/*
* 因为会先解析右侧，self 为 undefined
*/</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>解决方法：使用Map设置缓存，已经深拷贝过的数据直接去缓存中寻找。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">DeepClone</span> <span class="token punctuation">{</span>
  <span class="token comment">/****************************/</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>cache <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">clone</span> <span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>source <span class="token keyword">instanceof</span> <span class="token class-name">Object</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> cacheCurrent <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>cache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>cacheCurrent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> cacheCurrent
        <span class="token punctuation">}</span>
    <span class="token comment">/****************************/</span>
        <span class="token keyword">let</span> dist <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>source <span class="token keyword">instanceof</span> <span class="token class-name">Array</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          dist <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>source <span class="token keyword">instanceof</span> <span class="token class-name">Function</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function-variable function">dist</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token keyword">return</span> <span class="token function">source</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token operator">...</span>arguments<span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
  <span class="token comment">/****************************/</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>cache<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> dist<span class="token punctuation">)</span>
  <span class="token comment">/****************************/</span>
        <span class="token comment">// 使用for in 遍历对象上所有数据</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> source<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          dist<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span>source<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span> 
        <span class="token punctuation">}</span>
      <span class="token keyword">return</span> dist
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> source
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><h6 id="环引用的爆栈问题"><a href="#环引用的爆栈问题" class="header-anchor">#</a> 环引用的爆栈问题</h6> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token punctuation">{</span> child<span class="token operator">:</span> <span class="token keyword">null</span> <span class="token punctuation">}</span>
<span class="token keyword">let</span> b <span class="token operator">=</span> a
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">20000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    b<span class="token punctuation">.</span>child <span class="token operator">=</span> <span class="token punctuation">{</span> child<span class="token operator">:</span> <span class="token keyword">null</span> <span class="token punctuation">}</span>
    b <span class="token operator">=</span> b<span class="token punctuation">.</span>child
<span class="token punctuation">}</span>
<span class="token keyword">const</span> a2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DeepClone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>一共有2w次引用，不可能存入chrome。Chrome的堆栈大概有1.2w左右。
会产生堆栈溢出。</p> <p>解决办法：把结构进行改造，把递归变成循环。每进入一个对象，不去复制，把对象放入数组中，把子元素放入数组的后面。</p> <h4 id="拷贝regexp、date"><a href="#拷贝regexp、date" class="header-anchor">#</a> 拷贝RegExp、Date</h4> <p>使用<code>new RegExp(source)</code> <code>new Date(source)</code> 进行拷贝</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">clone</span> <span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>source <span class="token keyword">instanceof</span> <span class="token class-name">Object</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> dist <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>source <span class="token keyword">instanceof</span> <span class="token class-name">Array</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      dist <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>source <span class="token keyword">instanceof</span> <span class="token class-name">Function</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function-variable function">dist</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">source</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token operator">...</span>arguments<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/************************************/</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>source <span class="token keyword">instanceof</span> <span class="token class-name">RegExp</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>source <span class="token keyword">instanceof</span> <span class="token class-name">Date</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/************************************/</span>
  <span class="token comment">//  ...</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h3 id="为什么使用class"><a href="#为什么使用class" class="header-anchor">#</a> 为什么使用class？</h3> <p>每次new一个deepClone，会得到新的空数组cache。
不然旧的cache会一直保留在内存中。</p> <h2 id="完整代码"><a href="#完整代码" class="header-anchor">#</a> 完整代码</h2> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">DeepClone</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>cache <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function">clone</span> <span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>source <span class="token keyword">instanceof</span> <span class="token class-name">Object</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>cache<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>cache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>source <span class="token keyword">instanceof</span> <span class="token class-name">Array</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                dist <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>source <span class="token keyword">instanceof</span> <span class="token class-name">Function</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function-variable function">dist</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">return</span> <span class="token function">source</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token operator">...</span>arguments<span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>source <span class="token keyword">instanceof</span> <span class="token class-name">RegExp</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                dist <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>source <span class="token keyword">instanceof</span> <span class="token class-name">Date</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                dist <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token keyword">let</span> dist <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
            <span class="token punctuation">}</span>     
            <span class="token keyword">this</span><span class="token punctuation">.</span>cache<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> dist<span class="token punctuation">)</span>
          
            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">in</span> target<span class="token punctuation">)</span><span class="token punctuation">{</span>
                  <span class="token comment">// 过滤掉原型身上的属性</span>
                 <span class="token keyword">if</span> <span class="token punctuation">(</span>target<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                     dist<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">deepClone</span><span class="token punctuation">(</span>target<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span> cache<span class="token punctuation">)</span><span class="token punctuation">;</span>
                 <span class="token punctuation">}</span>
             <span class="token punctuation">}</span>
            <span class="token keyword">return</span> dist
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> source
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">'方方'</span><span class="token punctuation">}</span>
a<span class="token punctuation">.</span>self <span class="token operator">=</span> a
<span class="token keyword">const</span> a2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DeepClone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a2<span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> DeepClone
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br></div></div><h2 id="面试中写这些就行"><a href="#面试中写这些就行" class="header-anchor">#</a> 面试中写这些就行</h2> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// instanceof Object</span>
<span class="token comment">// 递归拷贝所有 key，除了原型链上的</span>
<span class="token comment">// Array {}</span>
<span class="token keyword">class</span> <span class="token class-name">deepClone</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>cache <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">clone</span> <span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>source <span class="token keyword">instanceof</span> <span class="token class-name">Object</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>cache<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>cache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">let</span> dist <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>source <span class="token keyword">instanceof</span> <span class="token class-name">Array</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        dist <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>source <span class="token keyword">instanceof</span> <span class="token class-name">Function</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function-variable function">dist</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token function">source</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>cache<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> dist<span class="token punctuation">)</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> sourceKey <span class="token keyword">in</span> source<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>source<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span>sourceKey<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          dist<span class="token punctuation">[</span>sourceKey<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span>source<span class="token punctuation">[</span>sourceKey<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> dist
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> source
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">11/13/2020, 1:31:18 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/interview_blog/jsBasis/extend.html" class="prev">
        继承
      </a></span> <span class="next"><a href="/interview_blog/jsBasis/throttle.html">
        防抖 vs 节流
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/interview_blog/assets/js/app.6e789ca6.js" defer></script><script src="/interview_blog/assets/js/2.aedcd1eb.js" defer></script><script src="/interview_blog/assets/js/25.dbe614ed.js" defer></script>
  </body>
</html>
