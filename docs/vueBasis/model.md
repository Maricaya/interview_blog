---
sidebarDepth: 3
---
# 双向数据绑定原理

## vue2 

https://github.com/su37josephxia/vue3-study/tree/master/demo/reactivity-demo
 vue 2 的实现方式是通过Object.defineProperty来重新定义getter，setter方法实现
 当然还有两个重要的问题需要处理
 - 第一个就是这样做只能做浅层响应 也就是如果是第二层就不行了。
   - 解决办法：递归调用，递归也带来了性能上的极大损失
 - 然后是数组问题 数组问题我们可以通过函数劫持的方式解决

 ## vue 3
 使用ES6的Proxy方式来解决这个问题

 首先Proxy是支持数组的，也就是数组不需要做特别的处理。
 对于深层监听也不不必要使用递归的方式解决。

 当get是判断值为对象时，做响应式处理返回就可以了。
 这个并不不是发生在初始化的时候，而是设置值得时候，所以性能上得到很大的提升。
 
## data 为什么 return
- 当一个组件被定义， data 必须声明为返回一个初始数据对象的函数，因为组件可能被用来创建多个实例。
- 如果 data 仍然是一个纯粹的对象，则所有的实例将共享引用同一个数据对象！
- 通过提供 data 函数，每次创建一个新实例后，我们能够调用 data 函数，从而返回初始数据的一个全新副本数据对象。
