---
sidebarDepth: 3
---
# 垃圾回收

从三个点来回答什么是垃圾、如何捡垃圾、什么时候捡垃圾。

1. 什么是垃圾

    - 不再需要，即为垃圾
    
    - 全局变量随时可能用到，所以一定不是垃圾
    
2. 如何捡垃圾（遍历算法）
    - 标记空间中「可达」值。
        -   从根节点（Root）出发，遍历所有的对象。
        -   可以遍历到的对象，是可达的（reachable）。
        -   没有被遍历到的对象，不可达的（unreachable）
    -   回收「不可达」的值所占据的内存。做内存整理。

3. 什么时候捡垃圾
    -   前端有其特殊性，垃圾回收的时候会造成页面卡顿。
    -   分代收集
        -   把数据分为新生代、老生代
        -   老生代：标记-清除-整理 执行垃圾回收。
            -   优点的是无需移动对象，缺点是产生内存碎片，需要清除内存碎片，速度较慢。
        -   新生代：`Scavenge` 算法。
            -   将内存一分为二，对象区、空间区。
                -   标记对象区，将存活对象有序地复制到空闲区，然后对调两个区数据
            -   优点是速度快无内存碎片，缺点是占用双倍内存空间。
        -   一句话总结分代回收就是：将堆分为新生代与老生代，多回收新生代，少回收老生代。
    -   增量收集
        -   引擎将垃圾收集工作分成更小的块，每次处理一部分，多次处理。
          这样就解决了长时间停顿的问题。
    -   闲时收集
        -   垃圾收集器只会在 CPU 空闲时尝试运行，以减少可能对代码执行的影响。
