<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>从输入URL到页面加载发生了什么？ | blog</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="系统性学习，打造完善的知识体系">
    
    <link rel="preload" href="/interview_blog/assets/css/0.styles.81bffcaa.css" as="style"><link rel="preload" href="/interview_blog/assets/js/app.6e789ca6.js" as="script"><link rel="preload" href="/interview_blog/assets/js/2.aedcd1eb.js" as="script"><link rel="preload" href="/interview_blog/assets/js/7.397ab168.js" as="script"><link rel="prefetch" href="/interview_blog/assets/js/10.235d3cd2.js"><link rel="prefetch" href="/interview_blog/assets/js/11.64c88d1d.js"><link rel="prefetch" href="/interview_blog/assets/js/12.389e02a9.js"><link rel="prefetch" href="/interview_blog/assets/js/13.5fd0b99f.js"><link rel="prefetch" href="/interview_blog/assets/js/14.addbf244.js"><link rel="prefetch" href="/interview_blog/assets/js/15.aaa172ef.js"><link rel="prefetch" href="/interview_blog/assets/js/16.efde6c27.js"><link rel="prefetch" href="/interview_blog/assets/js/17.efe499ad.js"><link rel="prefetch" href="/interview_blog/assets/js/18.b43e2679.js"><link rel="prefetch" href="/interview_blog/assets/js/19.1e7d1f1d.js"><link rel="prefetch" href="/interview_blog/assets/js/20.61100763.js"><link rel="prefetch" href="/interview_blog/assets/js/21.77d90c63.js"><link rel="prefetch" href="/interview_blog/assets/js/22.f398ec5f.js"><link rel="prefetch" href="/interview_blog/assets/js/23.a0ed082a.js"><link rel="prefetch" href="/interview_blog/assets/js/24.a5e14725.js"><link rel="prefetch" href="/interview_blog/assets/js/25.dbe614ed.js"><link rel="prefetch" href="/interview_blog/assets/js/26.f2947465.js"><link rel="prefetch" href="/interview_blog/assets/js/27.ccd771c7.js"><link rel="prefetch" href="/interview_blog/assets/js/28.78bc3610.js"><link rel="prefetch" href="/interview_blog/assets/js/29.ad03d3fc.js"><link rel="prefetch" href="/interview_blog/assets/js/3.b709dd0d.js"><link rel="prefetch" href="/interview_blog/assets/js/30.12e12cb8.js"><link rel="prefetch" href="/interview_blog/assets/js/31.63b1cf5c.js"><link rel="prefetch" href="/interview_blog/assets/js/32.10ace32c.js"><link rel="prefetch" href="/interview_blog/assets/js/33.14d149d9.js"><link rel="prefetch" href="/interview_blog/assets/js/34.b8c73cce.js"><link rel="prefetch" href="/interview_blog/assets/js/35.3e8d4f21.js"><link rel="prefetch" href="/interview_blog/assets/js/36.ed8a1bb7.js"><link rel="prefetch" href="/interview_blog/assets/js/37.ce354d46.js"><link rel="prefetch" href="/interview_blog/assets/js/38.37bcf5ce.js"><link rel="prefetch" href="/interview_blog/assets/js/39.d4956b62.js"><link rel="prefetch" href="/interview_blog/assets/js/4.87406268.js"><link rel="prefetch" href="/interview_blog/assets/js/40.f0ecd4dc.js"><link rel="prefetch" href="/interview_blog/assets/js/41.01c18d9c.js"><link rel="prefetch" href="/interview_blog/assets/js/42.f229993f.js"><link rel="prefetch" href="/interview_blog/assets/js/43.f08935e7.js"><link rel="prefetch" href="/interview_blog/assets/js/44.d134aed1.js"><link rel="prefetch" href="/interview_blog/assets/js/45.dbda6222.js"><link rel="prefetch" href="/interview_blog/assets/js/46.661000b0.js"><link rel="prefetch" href="/interview_blog/assets/js/47.12709f91.js"><link rel="prefetch" href="/interview_blog/assets/js/48.d8e794b9.js"><link rel="prefetch" href="/interview_blog/assets/js/5.c38690e3.js"><link rel="prefetch" href="/interview_blog/assets/js/6.f9104e5b.js"><link rel="prefetch" href="/interview_blog/assets/js/8.3afdacb3.js"><link rel="prefetch" href="/interview_blog/assets/js/9.a12c6f31.js">
    <link rel="stylesheet" href="/interview_blog/assets/css/0.styles.81bffcaa.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/interview_blog/" class="home-link router-link-active"><!----> <span class="site-name">blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/interview_blog/" class="nav-link">
  文章目录
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/interview_blog/" class="nav-link">
  文章目录
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/interview_blog/" aria-current="page" class="sidebar-link">JavaScript</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>vue3 UI</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JS 基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>TypeScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ajax &amp; jsonp</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>webpack</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>http</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>浏览器原理</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/interview_blog/chrome/gc.html" class="sidebar-link">垃圾回收</a></li><li><a href="/interview_blog/chrome/render.html" aria-current="page" class="active sidebar-link">从输入URL到页面加载发生了什么？</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/interview_blog/chrome/render.html#dns解析" class="sidebar-link">DNS解析</a></li><li class="sidebar-sub-header"><a href="/interview_blog/chrome/render.html#dns优化" class="sidebar-link">DNS优化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/interview_blog/chrome/render.html#dns缓存" class="sidebar-link">DNS缓存</a></li><li class="sidebar-sub-header"><a href="/interview_blog/chrome/render.html#dns负载均衡" class="sidebar-link">DNS负载均衡</a></li></ul></li><li class="sidebar-sub-header"><a href="/interview_blog/chrome/render.html#tcp连接三次握手" class="sidebar-link">TCP连接三次握手</a></li><li class="sidebar-sub-header"><a href="/interview_blog/chrome/render.html#四次挥手" class="sidebar-link">四次挥手</a></li><li class="sidebar-sub-header"><a href="/interview_blog/chrome/render.html#浏览器解析渲染页面" class="sidebar-link">浏览器解析渲染页面</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/interview_blog/chrome/render.html#reflow-回流" class="sidebar-link">reflow 回流</a></li><li class="sidebar-sub-header"><a href="/interview_blog/chrome/render.html#repaint-重绘" class="sidebar-link">repaint 重绘</a></li></ul></li><li class="sidebar-sub-header"><a href="/interview_blog/chrome/render.html#js的解析是由浏览器中的js解析引擎完成的。" class="sidebar-link">JS的解析是由浏览器中的JS解析引擎完成的。</a></li><li class="sidebar-sub-header"><a href="/interview_blog/chrome/render.html#web优化" class="sidebar-link">Web优化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/interview_blog/chrome/render.html#如何尽快的加载资源" class="sidebar-link">如何尽快的加载资源？</a></li><li class="sidebar-sub-header"><a href="/interview_blog/chrome/render.html#如何加快首屏渲染-你有哪些方案" class="sidebar-link">如何加快首屏渲染，你有哪些方案?</a></li><li class="sidebar-sub-header"><a href="/interview_blog/chrome/render.html#性能优化从哪些方面入手" class="sidebar-link">性能优化从哪些方面入手？</a></li></ul></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>安全</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>设计模式</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>函数式编程</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>算法</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>SSR</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>CSS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>react</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="从输入url到页面加载发生了什么"><a href="#从输入url到页面加载发生了什么" class="header-anchor">#</a> 从输入URL到页面加载发生了什么？</h1> <ol><li>DNS解析</li> <li>TCP连接</li> <li>发送HTTP请求</li> <li>服务器处理请求并返回HTTP报文</li> <li>浏览器解析渲染页面</li> <li>连接结束</li></ol> <h2 id="dns解析"><a href="#dns解析" class="header-anchor">#</a> DNS解析</h2> <p>DNS解析的过程就是寻找哪台机器上有你需要资源的过程。当你在浏览器中输入一个地址时，例如www.baidu.com，其实不是百度网站真正意义上的地址。互联网上每一台计算机的唯一标识是它的IP地址，但是IP地址并不方便记忆。用户更喜欢用方便记忆的网址去寻找互联网上的其它计算机，也就是上面提到的百度的网址。所以互联网设计者需要在用户的方便性与可用性方面做一个权衡，这个权衡就是一个网址到IP地址的转换，这个过程就是DNS解析。它实际上充当了一个翻译的角色，实现了网址到IP地址的转换。网址到IP地址转换的过程是如何进行的?</p> <p>DNS解析是一个递归查询的过程。</p> <h2 id="dns优化"><a href="#dns优化" class="header-anchor">#</a> DNS优化</h2> <h3 id="dns缓存"><a href="#dns缓存" class="header-anchor">#</a> DNS缓存</h3> <div class="language- extra-class"><pre><code>DNS存在着多级缓存，从离浏览器的距离排序的话，有以下几种: 浏览器缓存，系统缓存，路由器缓存，IPS服务器缓存，根域名服务器缓存，顶级域名服务器缓存，主域名服务器缓存。
</code></pre></div><h3 id="dns负载均衡"><a href="#dns负载均衡" class="header-anchor">#</a> DNS负载均衡</h3> <p>不知道大家有没有思考过一个问题: DNS返回的IP地址是否每次都一样？如果每次都一样是否说明你请求的资源都位于同一台机器上面，那么这台机器需要多高的性能和储存才能满足亿万请求呢？其实真实的互联网世界背后存在成千上百台服务器，大型的网站甚至更多。但是在用户的眼中，它需要的只是处理他的请求，哪台机器处理请求并不重要。DNS可以返回一个合适的机器的IP给用户，例如可以根据每台机器的负载量，该机器离用户地理位置的距离等等，这种过程就是DNS负载均衡，又叫做DNS重定向。大家耳熟能详的CDN(Content Delivery Network)就是利用DNS的重定向技术，DNS服务器会返回一个跟用户最接近的点的IP地址给用户，CDN节点的服务器负责响应用户的请求，提供所需的内容。在这里打个免费的广告，我平时使用的比较多的是七牛云的CDN(免费)储存图片，作为我个人博客的图床使用。</p> <h2 id="tcp连接三次握手"><a href="#tcp连接三次握手" class="header-anchor">#</a> TCP连接三次握手</h2> <p>也是我们常说的“三次握手”（听说过这个概念吗）
每次建立连接前，客户端和服务端之前都要先进行三次对话才开始正式传输内容。
这个问题的本质是：客户端和服务端之间的通信渠道并不可靠， 但是通信双方需要就某个问题达成一致。而要解决这个问题, 无论你在消息中包含什么信息, 三次通信是理论上的最小值。</p> <p>为了保证服务端能收接受到客户端的信息，并能做出正确的应答而进行前两次(第一次和第二次)握手，为了保证客户端能够接收到服务端的信息，并能做出正确的应答而进行后两次(第二次和第三次)握手。</p> <h2 id="四次挥手"><a href="#四次挥手" class="header-anchor">#</a> 四次挥手</h2> <p>三次握手是建立TCP连接，四次挥手是终止TCP连接。
TCP 的连接的拆除需要发送四个包，因此称为四次挥手(Four-way handshake)，也叫做改进的三次握手。客户端或服务器均可主动发起挥手动作，四次挥手的过程可以形象地理解为一问一答，双方都经过了这个过程就可以结束这个连接了。</p> <p>简单理解版本：
1、客户端 -&gt; 服务端 ： 我要关闭连接咯
2、服务端 -&gt; 客户端 : 好的
3、服务端 -&gt; 客户端 ： 我要关闭连接咯
4、服务端 -&gt; 客户端 : 好的</p> <h2 id="浏览器解析渲染页面"><a href="#浏览器解析渲染页面" class="header-anchor">#</a> <strong>浏览器解析渲染页面</strong></h2> <p>浏览器在收到HTML,CSS,JS文件后，它是如何把页面呈现到屏幕上的？下图对应的就是WebKit渲染的过程。
<img src="/interview_blog/assets/img/render.9e2f2f74.png" alt="">
浏览器是一个边解析边渲染的过程。</p> <p>首先浏览器解析HTML文件构建DOM树，然后解析CSS文件构建渲染树，等到渲染树构建完成后，浏览器开始布局渲染树并将其绘制到屏幕上。</p> <p>这个过程比较复杂，涉及到两个概念: reflow(回流)和repaint(重绘)。</p> <p>DOM节点中的各个元素都是以盒模型的形式存在，这些都需要浏览器去计算其位置和大小等，这个过程称为relow;当盒模型的位置,大小以及其他属性，如颜色,字体,等确定下来之后，浏览器便开始绘制内容，这个过程称为repain。</p> <p>页面在首次加载时必然会经历reflow和repain。reflow和repain过程是非常消耗性能的，尤其是在移动设备上，它会破坏用户体验，有时会造成页面卡顿。所以我们应该尽可能少的减少reflow和repain。</p> <h3 id="reflow-回流"><a href="#reflow-回流" class="header-anchor">#</a> reflow 回流</h3> <p>会触发 css dom 修改</p> <p>重排需要更新完整 的渲染流水线，所以开销也是最大的。</p> <h3 id="repaint-重绘"><a href="#repaint-重绘" class="header-anchor">#</a> repaint 重绘</h3> <p>和回流相比，重绘省去了布局和分层阶段，所以执行效率会比重排操作要高一些。</p> <h2 id="js的解析是由浏览器中的js解析引擎完成的。"><a href="#js的解析是由浏览器中的js解析引擎完成的。" class="header-anchor">#</a> JS的解析是由浏览器中的JS解析引擎完成的。</h2> <p>JS是单线程运行，也就是说，在同一个时间内只能做一件事，所有的任务都需要排队，前一个任务结束，后一个任务才能开始。</p> <p>但是又存在某些任务比较耗时，如IO读写等，所以需要一种机制可以先执行排在后面的任务，这就是：同步任务(synchronous)和异步任务(asynchronous)。</p> <p>JS的执行机制就可以看做是一个主线程加上一个任务队列(task queue)。</p> <p>同步任务就是放在主线程上执行的任务，异步任务是放在任务队列中的任务。</p> <p>所有的同步任务在主线程上执行，形成一个执行栈;异步任务有了运行结果就会在任务队列中放置一个事件；脚本运行时先依次运行执行栈，然后会从任务队列里提取事件，运行任务队列中的任务，这个过程是不断重复的，所以又叫做事件循环(Event loop)。</p> <p>浏览器在解析过程中，如果遇到请求外部资源时，如图像,iconfont,JS等。</p> <p>浏览器将重复1-6过程下载该资源。请求过程是异步的，并不会影响HTML文档进行加载，但是当文档加载过程中遇到JS文件，HTML文档会挂起渲染过程，不仅要等到文档中JS文件加载完毕还要等待解析执行完毕，才会继续HTML的渲染过程。原因是因为JS有可能修改DOM结构，这就意味着JS执行完成前，后续所有资源的下载是没有必要的，这就是JS阻塞后续资源下载的根本原因。</p> <p>CSS文件的加载不影响JS文件的加载，但是却影响JS文件的执行。JS代码执行前浏览器必须保证CSS文件已经下载并加载完毕。</p> <h2 id="web优化"><a href="#web优化" class="header-anchor">#</a> Web优化</h2> <p>上面部分主要介绍了一次完整的请求对应的过程，了解该过程的目的无非就是为了Web优化。</p> <p>在谈到Web优化之前，我们回到一个更原始的问题，Web前端的本质是什么。</p> <p>我的理解是: 将信息快速并友好的展示给用户并能够与用户进行交互。</p> <p>快速的意思就是在尽可能短的时间内完成页面的加载，试想一下当你在淘宝购买东西的时候，淘宝页面加载了10几秒才显示出物品，这个时候你还有心情去购买吗？怎么快速的完成页面的加载呢？</p> <h3 id="如何尽快的加载资源"><a href="#如何尽快的加载资源" class="header-anchor">#</a> 如何尽快的加载资源？</h3> <p>答案就是能不从网络中加载的资源就不从网络中加载，当我们合理使用缓存，将资源放在浏览器端，这是最快的方式。</p> <p>如果资源必须从网络中加载，则要考虑缩短连接时间，即DNS优化部分;减少响应内容大小，即对内容进行压缩。</p> <p>另一方面，如果加载的资源数比较少的话，也可以快速的响应用户。</p> <p>当资源到达浏览器之后，浏览器开始进行解析渲染，浏览器中最耗时的部分就是reflow，所以围绕这一部分就是考虑如何减少reflow的次数。</p> <h3 id="如何加快首屏渲染-你有哪些方案"><a href="#如何加快首屏渲染-你有哪些方案" class="header-anchor">#</a> 如何加快首屏渲染，你有哪些方案?</h3> <ul><li>降低请求量：合并资源，减少 HTTP 请求数，minify / gzip 压缩，webP，lazyload。</li> <li>加快请求速度：预解析DNS，减少域名数，并行加载，CDN 分发。</li> <li>增加缓存：HTTP 协议缓存请求，离线缓存 manifest，离线数据缓存 localStorage、PWA。</li> <li>渲染优化：首屏内容最小化，JS/CSS优化，加载顺序，服务端渲染，pipeline。</li></ul> <h3 id="性能优化从哪些方面入手"><a href="#性能优化从哪些方面入手" class="header-anchor">#</a> 性能优化从哪些方面入手？</h3> <ul><li>分屏加载，当页面需要渲染的数据较多时，先渲染首屏，下滑时再加载第二屏的数据；</li> <li>图片大小优化，在不影响视觉效果的前提下，把图片尺寸降到最小；</li> <li>图片懒加载，on appear时再加载图片；</li> <li>Code splitting，或者拆包，应用下的某些组件不需要立刻import，可以采用动态import的方式，打包时也可以将它们打到不同的bundle里，给index bundle瘦身；</li> <li>Chrome Devtools - Trace &amp; Timeline等一系列强大的分析工具可以去研究一下，它们可以深入到内核分析应用的性能问题所在；</li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">11/11/2020, 8:21:07 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/interview_blog/chrome/gc.html" class="prev">
        垃圾回收
      </a></span> <span class="next"><a href="/interview_blog/safe/csrf.html">
        安全问题
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/interview_blog/assets/js/app.6e789ca6.js" defer></script><script src="/interview_blog/assets/js/2.aedcd1eb.js" defer></script><script src="/interview_blog/assets/js/7.397ab168.js" defer></script>
  </body>
</html>
