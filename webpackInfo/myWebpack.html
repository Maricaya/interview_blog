<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>打包原理 | blog</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="系统性学习，打造完善的知识体系">
    
    <link rel="preload" href="/interview_blog/assets/css/0.styles.81bffcaa.css" as="style"><link rel="preload" href="/interview_blog/assets/js/app.6e789ca6.js" as="script"><link rel="preload" href="/interview_blog/assets/js/2.aedcd1eb.js" as="script"><link rel="preload" href="/interview_blog/assets/js/46.661000b0.js" as="script"><link rel="prefetch" href="/interview_blog/assets/js/10.235d3cd2.js"><link rel="prefetch" href="/interview_blog/assets/js/11.64c88d1d.js"><link rel="prefetch" href="/interview_blog/assets/js/12.389e02a9.js"><link rel="prefetch" href="/interview_blog/assets/js/13.5fd0b99f.js"><link rel="prefetch" href="/interview_blog/assets/js/14.addbf244.js"><link rel="prefetch" href="/interview_blog/assets/js/15.aaa172ef.js"><link rel="prefetch" href="/interview_blog/assets/js/16.efde6c27.js"><link rel="prefetch" href="/interview_blog/assets/js/17.efe499ad.js"><link rel="prefetch" href="/interview_blog/assets/js/18.b43e2679.js"><link rel="prefetch" href="/interview_blog/assets/js/19.1e7d1f1d.js"><link rel="prefetch" href="/interview_blog/assets/js/20.61100763.js"><link rel="prefetch" href="/interview_blog/assets/js/21.77d90c63.js"><link rel="prefetch" href="/interview_blog/assets/js/22.f398ec5f.js"><link rel="prefetch" href="/interview_blog/assets/js/23.a0ed082a.js"><link rel="prefetch" href="/interview_blog/assets/js/24.a5e14725.js"><link rel="prefetch" href="/interview_blog/assets/js/25.dbe614ed.js"><link rel="prefetch" href="/interview_blog/assets/js/26.f2947465.js"><link rel="prefetch" href="/interview_blog/assets/js/27.ccd771c7.js"><link rel="prefetch" href="/interview_blog/assets/js/28.78bc3610.js"><link rel="prefetch" href="/interview_blog/assets/js/29.ad03d3fc.js"><link rel="prefetch" href="/interview_blog/assets/js/3.b709dd0d.js"><link rel="prefetch" href="/interview_blog/assets/js/30.12e12cb8.js"><link rel="prefetch" href="/interview_blog/assets/js/31.63b1cf5c.js"><link rel="prefetch" href="/interview_blog/assets/js/32.10ace32c.js"><link rel="prefetch" href="/interview_blog/assets/js/33.14d149d9.js"><link rel="prefetch" href="/interview_blog/assets/js/34.b8c73cce.js"><link rel="prefetch" href="/interview_blog/assets/js/35.3e8d4f21.js"><link rel="prefetch" href="/interview_blog/assets/js/36.ed8a1bb7.js"><link rel="prefetch" href="/interview_blog/assets/js/37.ce354d46.js"><link rel="prefetch" href="/interview_blog/assets/js/38.37bcf5ce.js"><link rel="prefetch" href="/interview_blog/assets/js/39.d4956b62.js"><link rel="prefetch" href="/interview_blog/assets/js/4.87406268.js"><link rel="prefetch" href="/interview_blog/assets/js/40.f0ecd4dc.js"><link rel="prefetch" href="/interview_blog/assets/js/41.01c18d9c.js"><link rel="prefetch" href="/interview_blog/assets/js/42.f229993f.js"><link rel="prefetch" href="/interview_blog/assets/js/43.f08935e7.js"><link rel="prefetch" href="/interview_blog/assets/js/44.d134aed1.js"><link rel="prefetch" href="/interview_blog/assets/js/45.dbda6222.js"><link rel="prefetch" href="/interview_blog/assets/js/47.12709f91.js"><link rel="prefetch" href="/interview_blog/assets/js/48.d8e794b9.js"><link rel="prefetch" href="/interview_blog/assets/js/5.c38690e3.js"><link rel="prefetch" href="/interview_blog/assets/js/6.f9104e5b.js"><link rel="prefetch" href="/interview_blog/assets/js/7.397ab168.js"><link rel="prefetch" href="/interview_blog/assets/js/8.3afdacb3.js"><link rel="prefetch" href="/interview_blog/assets/js/9.a12c6f31.js">
    <link rel="stylesheet" href="/interview_blog/assets/css/0.styles.81bffcaa.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/interview_blog/" class="home-link router-link-active"><!----> <span class="site-name">blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/interview_blog/" class="nav-link">
  文章目录
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/interview_blog/" class="nav-link">
  文章目录
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/interview_blog/" aria-current="page" class="sidebar-link">JavaScript</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>vue3 UI</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JS 基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>TypeScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ajax &amp; jsonp</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>webpack</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/interview_blog/webpackInfo/compile.html" class="sidebar-link">你用 webpack 做过什么优化吗？</a></li><li><a href="/interview_blog/webpackInfo/myWebpack.html" aria-current="page" class="active sidebar-link">打包原理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/interview_blog/webpackInfo/myWebpack.html#什么是模块" class="sidebar-link">什么是模块</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/interview_blog/webpackInfo/myWebpack.html#后端" class="sidebar-link">后端</a></li><li class="sidebar-sub-header"><a href="/interview_blog/webpackInfo/myWebpack.html#前端" class="sidebar-link">前端</a></li></ul></li><li class="sidebar-sub-header"><a href="/interview_blog/webpackInfo/myWebpack.html#打包解决了什么问题" class="sidebar-link">打包解决了什么问题？</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/interview_blog/webpackInfo/myWebpack.html#_1-模块化" class="sidebar-link">1. 模块化</a></li><li class="sidebar-sub-header"><a href="/interview_blog/webpackInfo/myWebpack.html#_2-捆绑" class="sidebar-link">2. 捆绑</a></li></ul></li><li class="sidebar-sub-header"><a href="/interview_blog/webpackInfo/myWebpack.html#如何打包" class="sidebar-link">如何打包</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/interview_blog/webpackInfo/myWebpack.html#_1-解析入口文件-获取所有的依赖项" class="sidebar-link">1. 解析入口文件，获取所有的依赖项</a></li><li class="sidebar-sub-header"><a href="/interview_blog/webpackInfo/myWebpack.html#_2-递归解析所有的依赖项-生成一个依赖关系图" class="sidebar-link">2. 递归解析所有的依赖项，生成一个依赖关系图</a></li><li class="sidebar-sub-header"><a href="/interview_blog/webpackInfo/myWebpack.html#_3-使用依赖图-返回一个可以在浏览器运行的-javascript-文件" class="sidebar-link">3. 使用依赖图，返回一个可以在浏览器运行的 JavaScript 文件</a></li><li class="sidebar-sub-header"><a href="/interview_blog/webpackInfo/myWebpack.html#_4-输出到-dist-bundle-js" class="sidebar-link">4. 输出到 dist/bundle.js</a></li></ul></li></ul></li><li><a href="/interview_blog/webpackInfo/babel.html" class="sidebar-link">AST、Babel、依赖</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>http</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>浏览器原理</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>安全</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>设计模式</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>函数式编程</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>算法</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>SSR</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>CSS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>react</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="打包原理"><a href="#打包原理" class="header-anchor">#</a> 打包原理</h1> <h2 id="什么是模块"><a href="#什么是模块" class="header-anchor">#</a> 什么是模块</h2> <p>由于前后端 JavaScript 分别搁置在 HTTP 的两端，它们扮演的角色不同，侧重点也不一样。</p> <ul><li>浏览器端的 JavaScript 需要经历从一个服务器端分发到多个客户端执行</li> <li>而服务器端 JS 则是相同的代码需要多次执行。</li> <li>前者的瓶颈在于宽带，后者的瓶颈则在于 CPU 等内存资源。</li> <li>前者需要通过网络加载代码，后者则需要从磁盘中加载，两者的加载速度也不是在一个数量级上的。</li></ul> <h3 id="后端"><a href="#后端" class="header-anchor">#</a> 后端</h3> <p>所以前后端的模块定义不是一致的，其中服务器端的模块定义为：</p> <ul><li>CJS（CommonJS）：旨在用于服务器端 JavaScript 的同步定义，Node 的模块系统实际上基于 CJS；</li></ul> <p>但 CommonJS 是以同步方式导入，因为用于服务端，文件都在本地，同步导入即使卡住主线程影响也不大，
但在浏览器端，如果在 UI 加载的过程中需要花费很多时间来等待脚本加载完成，这会造成用户体验的很大问题。
鉴于网络的原因， CommonJS 为后端 JavaScript 制定的规范并不完全适合与前端的应用场景，下面来介绍 JavaScript 前端的规范。</p> <h3 id="前端"><a href="#前端" class="header-anchor">#</a> 前端</h3> <ul><li>AMD（异步模块定义）：被定义为用于浏览器中模块的异步模型，RequireJS 是 AMD 最受欢迎的实现；</li> <li>UMD（通用模块定义）：它本质上一段 JavaScript 代码，放置在库的顶部，可让任何加载程序、任何环境加载它们；</li> <li>ES2015（ES6）：定义了异步导入和导出模块的语义，会编译成 <code>require/exports</code> 来执行的，这也是我们现今最常用的模块定义；</li></ul> <h2 id="打包解决了什么问题"><a href="#打包解决了什么问题" class="header-anchor">#</a> 打包解决了什么问题？</h2> <h3 id="_1-模块化"><a href="#_1-模块化" class="header-anchor">#</a> 1. 模块化</h3> <ul><li>在 HTML 引入时，我们需要注意这文件的引入顺序（如果顺序出错，项目就会报错），如果将其扩展到具有实际功能的可用的 web 项目中，那么可能需要引入几十个文件，依赖关系更是复杂。</li> <li>所以，我们需要将每个依赖项模块化，让打包器帮助我们管理这些模块。</li></ul> <h3 id="_2-捆绑"><a href="#_2-捆绑" class="header-anchor">#</a> 2. 捆绑</h3> <p>另外，当浏览器打开该网页时，每个 js 文件都需要一个单独的 http 请求，即 4 个往返请求，才能正确地启动你的项目。
我们知道浏览器加载模块很慢，即使是 HTTP/2 支持有效地加载许多小文件，但其性能都不如加载一个更加有效（即使不做任何优化）。
因此，最好将所有 4 个文件合并为1个：</p> <p>这样只需要一次 http 请求即可。</p> <p><strong>所以，模块化与捆绑是打包器需要实现的两个最主要功能。</strong></p> <h2 id="如何打包"><a href="#如何打包" class="header-anchor">#</a> 如何打包</h2> <h3 id="_1-解析入口文件-获取所有的依赖项"><a href="#_1-解析入口文件-获取所有的依赖项" class="header-anchor">#</a> 1. 解析入口文件，获取所有的依赖项</h3> <p><code>@babel/parser</code> 解析入口文件，获取 AST</p> <h3 id="_2-递归解析所有的依赖项-生成一个依赖关系图"><a href="#_2-递归解析所有的依赖项-生成一个依赖关系图" class="header-anchor">#</a> 2. 递归解析所有的依赖项，生成一个依赖关系图</h3> <h3 id="_3-使用依赖图-返回一个可以在浏览器运行的-javascript-文件"><a href="#_3-使用依赖图-返回一个可以在浏览器运行的-javascript-文件" class="header-anchor">#</a> 3. 使用依赖图，返回一个可以在浏览器运行的 JavaScript 文件</h3> <h3 id="_4-输出到-dist-bundle-js"><a href="#_4-输出到-dist-bundle-js" class="header-anchor">#</a> 4. 输出到 dist/bundle.js</h3></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">11/3/2020, 8:28:19 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/interview_blog/webpackInfo/compile.html" class="prev">
        你用 webpack 做过什么优化吗？
      </a></span> <span class="next"><a href="/interview_blog/webpackInfo/babel.html">
        AST、Babel、依赖
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/interview_blog/assets/js/app.6e789ca6.js" defer></script><script src="/interview_blog/assets/js/2.aedcd1eb.js" defer></script><script src="/interview_blog/assets/js/46.661000b0.js" defer></script>
  </body>
</html>
